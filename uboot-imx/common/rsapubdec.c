#include <common.h>
#include "rsa.h"
extern int RSA_eay_public_decrypt(int flen, const unsigned char *from,
	unsigned char *to, RSA *rsa,int padding);

int decode_hash_with_image(unsigned char *hash_128byte){
	int i,j,size;
	RSA *rsa=NULL;
	unsigned char rb[128],wb[128];
	unsigned char pubkey[]={
		0x89,0xa1,0xc1,0x4f,
		0xee,0xc2,0x95,0x32,
		0x5c,0x67,0xf3,0x09,
		0x0f,0x30,0xe6,0xf9,
		0x35,0x5d,0x31,0x40,
		0xa7,0xa6,0xd7,0x95,
		0x52,0x3c,0x26,0xd6,
		0x32,0xe8,0xea,0xc8,
		0x05,0x3f,0x4c,0xc0,
		0x6b,0x34,0x53,0xbd,
		0x04,0x19,0x8c,0x16,
		0xac,0x79,0x45,0xd6,
		0x1b,0x99,0x9b,0xf5,
		0x3b,0x0a,0x7e,0xf6,
		0x03,0xec,0xb6,0xdd,
		0xd9,0x95,0x91,0x8a,
		0x6f,0xbf,0xcd,0xe4,
		0x34,0x96,0x8e,0x4f,
		0x00,0x7e,0x0f,0xe0,
		0x4d,0x82,0xb5,0xc4,
		0x22,0x81,0xc0,0x3e,
		0xb8,0xc3,0x4e,0x83,
		0x00,0x6d,0x18,0x55,
		0xf6,0xb2,0xe5,0x11,
		0xf5,0x32,0xfa,0xf9,
		0x2a,0xb7,0x1c,0x19,
		0x13,0xf6,0x0f,0xed,
		0xf0,0x13,0x98,0x5f,
		0x12,0x42,0xac,0xd8,
		0x71,0x12,0x18,0x22,
		0xc6,0x77,0x16,0x19,
		0xed,0xd4,0x32,0xb4,
		0x00,0x00,0x00,0x00,
	};
	RSA rsa1;
	BIGNUM e,n;
	unsigned int ed=65537;

	memcpy(rb,hash_128byte,128);
	rsa=&rsa1;
	memset(rsa,0,sizeof(RSA));
	memset(&e,0,sizeof(BIGNUM));
	memset(&n,0,sizeof(BIGNUM));
	rsa->references=1;
	rsa->flags=6;
	rsa->e=&e;
	rsa->e->d=&ed;
	rsa->e->top=1;
	rsa->e->dmax=1;
	rsa->e->flags=1;
	rsa->n=&n;
	rsa->n->d=pubkey;
	rsa->n->top=32;
	rsa->n->dmax=33;
	rsa->n->flags=1;
	size=128;
	i=size;
	j=RSA_eay_public_decrypt(i,rb,wb,rsa,RSA_PKCS1_PADDING);
	if(j>0){
		memset(hash_128byte,0,128);
		memcpy(hash_128byte,wb,j);
		return j;
	}
	else{
		printf("RSA decrypt - failed\n");
		return 0;
	}
}
